#
# This file was generated from reference-repository.git
# Do not edit this file by hand. Your changes will be overwritten.
#

<%-
sensor.fetch('metrics', []).each {|metric|
  if metric['source']['protocol'] == 'snmp'
    if metric['source']['id'].include?('%PORT%')
      sensor.fetch('ports', {}).each {|port_uid, node_uid|
-%>
- name: <%= metric['name'] %>
  device_id: <%= sensor_uid %>-port-<%= port_uid %>
  labels: <%= {'_device_alias' => node_uid}.to_json %>
  url: snmp://<%= sensor.fetch('snmp_community', 'public')%>@<%= sensor_uid %>.<%= site_uid %>.grid5000.fr/<%= metric['source']['id'].sub('%PORT%',  "#{port_uid}") %>
  update_every: <%= metric['period'] > 0 ? metric['period'] : metric['optional_period'] %>
<%- if metric['period'] == 0 -%>
  optional: true
<%- end -%>
<%- if metric.has_key?('scale_factor') -%>
  scale_factor: <%= metric['scale_factor'] %>
<%- end -%>
<%-
      }
  else
-%>
- name: <%= metric['name'] %>
  device_id: <%= sensor_uid %>
  labels: <%= {'_device_alias' => sensor_uid}.to_json %>
  url: snmp://<%= sensor.fetch('snmp_community', 'public')%>@<%= sensor_uid %>.<%= site_uid %>.grid5000.fr/<%= metric['source']['id'] %>
  update_every: <%= metric['period'] > 0 ? metric['period'] : metric['optional_period'] %>
<%- if metric['period'] == 0 -%>
  optional: true
<%- end -%>
<%- if metric.has_key?('scale_factor') -%>
  scale_factor: <%= metric['scale_factor'] %>
<%- end -%>

<%-
  end  
else
-%>
- name: <%= metric['name'] %>
  device_id: <%= sensor_uid %>
  url: <%= metric['source']['protocol'] %>://<%= sensor_uid %>.<%= site_uid %>.grid5000.fr/<%= metric['source']['id'] %>
  <%- if metric.fetch('labels', {}) != {} -%>
  labels: <%= metric.fetch('labels', {}).to_json %>
  <%- end -%>
  update_every: <%= metric['period'] > 0 ? metric['period'] : metric['optional_period'] %>
<%- if metric['period'] == 0 -%>
  optional: true
<%- end -%>
<%- if metric.has_key?('scale_factor') -%>
  scale_factor: <%= metric['scale_factor'] %>
<%- end -%>

<%-
  end
-%>

<% } -%>