# MANAGED BY PUPPET
# Module : kavlang5k
# GENERATED by kavlang5k.rb
#
<%
refapi['sites'][site_uid].fetch('clusters', {}).sort.to_h.each do |cluster_uid, cluster|
-%>
<% if cluster['kavlan'] -%>
# Cluster <%= cluster_uid %>
<%
    cluster['nodes'].sort.to_h.each do |node_uid, node|
      next if node['status'] and node['status'] == "retired"
      node['network_adapters'].each do |interface|
          # puts interface.class
          # pp interface
          #nil.crash
        interface_has_kavlan = interface['kavlan']
        if interface_has_kavlan
          switch_uid = interface['switch']
          kavlan_port_name = kavlan_switch_port_lookup(refapi['sites'][site_uid]["network_equipments"][switch_uid], node_uid, interface['device'])
-%>
<%= node_uid %><%= interface['mounted']? "" : "-"+interface['device'] %>.<%= site_uid %>.grid5000.fr <%= kavlan_port_name %> <%= switch_uid %>
<%
        end
      end
    end
  end
end
-%>
